<?xml version="1.0" encoding="UTF-8"?><Session>
<Field name="Session Name">PKG_UPDATE_DIMENSION_LEVELS</Field>
<Field name="Context Code">GLOBAL</Field>
<SessStep>
<Field name="Step Name">Get the dimension table name</Field>
<Field name="Step No">0</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Get the concatenated dimension name</Field>
<Field name="Step No">1</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Get the primary column</Field>
<Field name="Step No">2</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Get the top members</Field>
<Field name="Step No">3</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Var_Source_Staging_Dimension_Table</Field>
<Field name="Step No">4</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Get the concatenated levels</Field>
<Field name="Step No">5</Field>
<Field name="Step Type">T</Field>
<Field name="Ok Next Step">6</Field>
<Field name="Ok Exit">0</Field>
<Field name="Ko Exit">1</Field>
<StepLog>
<SessTaskLog>
<Field name="Task Type ">S</Field>
<Field name="Task Name 1">Procedure</Field>
<Field name="Task Name 2">PRD_GET_CONCATENATED_DIMENSION_LEVELS</Field>
<Field name="Task Name 3">Update Concatenated Segments</Field>
<Field name="Exe Channel">J</Field>
<Field name="Source Context Code">GLOBAL</Field>
<Field name="Target Context Code">GLOBAL</Field>
<Field name="Target Logical Schema Name">LGL_STG</Field>
<Field name="Target Technology Internal Name">ORACLE</Field>
<Default>
<Field name="Text">UPDATE STG_#DW.Var_Dimension_Table_99
SET CONCAT_HIER=
(
 SELECT distinct '|'||max(TOPMEM||CONC.CONCATENATED)||'|' FROM 
(
	SELECT SYS_CONNECT_BY_PATH(CHILD,'|') CONCATENATED, LEVEL, GENERIC_ID, CONNECT_BY_ROOT PARENT AS TOPMEM, CONNECT_BY_ISLEAF AS ISLEAF
	FROM STG_T_PARENT_CHILD_D_1
	WHERE DIM_NAME='#DW.Var_Dim_Name' 
	START WITH PARENT IN (#DW.Var_List_Dimension_Top_Members )
	CONNECT BY PRIOR CHILD=PARENT
  
) CONC
	WHERE 
	
	 SUBSTR(CONC.CONCATENATED,INSTR(CONC.CONCATENATED,'|',-1,1)+1)=STG_#DW.Var_Dimension_Table_99.#DW.Var_Primary_Column_Name
	AND CONC.GENERIC_ID=STG_#DW.Var_Dimension_Table_99.GENERIC_ID
	AND CONC.ISLEAF=1
	)
where exists
(SELECT distinct NULL
from (
	SELECT SYS_CONNECT_BY_PATH(CHILD,'|') CONCATENATED, LEVEL, GENERIC_ID, CONNECT_BY_ROOT PARENT AS TOPMEM, CONNECT_BY_ISLEAF AS ISLEAF
	FROM STG_T_PARENT_CHILD_D_1
	WHERE DIM_NAME='#DW.Var_Dim_Name' 
	START WITH PARENT IN (#DW.Var_List_Dimension_Top_Members )
	CONNECT BY PRIOR CHILD=PARENT
) CONC, STG_#DW.Var_Dimension_Table_99
	WHERE 
	
	 SUBSTR(CONC.CONCATENATED,INSTR(CONC.CONCATENATED,'|',-1,1)+1)=STG_#DW.Var_Dimension_Table_99.#DW.Var_Primary_Column_Name
	AND CONC.GENERIC_ID=STG_#DW.Var_Dimension_Table_99.GENERIC_ID
  AND CONC.ISLEAF=1)</Field>
</Default>
</SessTaskLog>
</StepLog>
</SessStep>
<SessStep>
<Field name="Step Name">Get the maximum levels of hierarchy</Field>
<Field name="Step No">6</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Var_Counter</Field>
<Field name="Step No">7</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Print Variables</Field>
<Field name="Step No">8</Field>
<Field name="Step Type">T</Field>
<Field name="Ok Next Step">9</Field>
<Field name="Ok Exit">0</Field>
<Field name="Ko Exit">1</Field>
<StepLog>
<SessTaskLog>
<Field name="Task Type ">S</Field>
<Field name="Task Name 1">Procedure</Field>
<Field name="Task Name 2">PRD_PRINT_VARIABLES_HIERARCHY_LEVELS</Field>
<Field name="Task Name 3">Print Variables for Hierarchy Levels</Field>
<Field name="Exe Channel">B</Field>
<Field name="Source Context Code">GLOBAL</Field>
<Field name="Target Context Code">GLOBAL</Field>
<Field name="Target Technology Internal Name">JYTHON</Field>
<Default>
<Field name="Text">raise("""
Source = #DW.Var_Source
Current Operating Unit = #DW.Var_Curr_Operating_Unit
Current Dimension = #DW.Var_Dim_Name
Dimension Table = #DW.Var_Dimension_Table 
Maximum number of levels = #DW.Var_Curr_Dim_Max_Level
Top members of the current dimension = #DW.Var_List_Dimension_Top_Members
EBS Chart of Accounts = #DW.Var_EBS_COA
Primary Column of the dimension = #DW.Var_Primary_Column_Name
""") </Field>
</Default>
</SessTaskLog>
</StepLog>
</SessStep>
<SessStep>
<Field name="Step Name">Get the parent name</Field>
<Field name="Step No">9</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Get the parent code</Field>
<Field name="Step No">10</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Get the child name</Field>
<Field name="Step No">11</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Get the child code</Field>
<Field name="Step No">12</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Update the hierarchy levels </Field>
<Field name="Step No">13</Field>
<Field name="Step Type">T</Field>
<Field name="Ok Next Step">14</Field>
<Field name="Ok Exit">0</Field>
<Field name="Ko Exit">1</Field>
<StepLog>
<SessTaskLog>
<Field name="Task Type ">S</Field>
<Field name="Task Name 1">Procedure</Field>
<Field name="Task Name 2">PRD_UPDATE_DIM_LEVELS</Field>
<Field name="Task Name 3">Populate Hierarchy Levels</Field>
<Field name="Exe Channel">J</Field>
<Field name="Source Context Code">GLOBAL</Field>
<Field name="Target Context Code">GLOBAL</Field>
<Field name="Target Logical Schema Name">LGL_STG</Field>
<Field name="Target Technology Internal Name">ORACLE</Field>
<Default>
<Field name="Text">UPDATE STG_#DW.Var_Dimension_Table_99 TARG
SET #DW.Var_Dim_Child_Column_Num = 
NVL(substr(concat_hier,instr(concat_hier,'|',1,#DW.Var_Counter)+1, instr(concat_hier,'|',1,to_number(#DW.Var_Counter)+1)-(instr(concat_hier,'|',1,#DW.Var_Counter)+1)),#DW.Var_Primary_Column_Name)</Field>
</Default>
</SessTaskLog>
<SessTaskLog>
<Field name="Task Type ">S</Field>
<Field name="Task Name 1">Procedure</Field>
<Field name="Task Name 2">PRD_UPDATE_DIM_LEVELS</Field>
<Field name="Task Name 3">Update the parent description</Field>
<Field name="Exe Channel">J</Field>
<Field name="Source Context Code">GLOBAL</Field>
<Field name="Target Context Code">GLOBAL</Field>
<Field name="Target Logical Schema Name">LGL_STG</Field>
<Field name="Target Technology Internal Name">ORACLE</Field>
<Default>
<Field name="Text">UPDATE STG_#DW.Var_Dimension_Table_99 TARG
SET #DW.Var_Dim_Child_Column_Name=(Select max(MEMBER_DESC) from STG_T_PARENT_CHILD_D_2 where STG_T_PARENT_CHILD_D_2.MEMBER=TARG.#DW.Var_Dim_Child_Column_Num and STG_T_PARENT_CHILD_D_2.SOURCE='#DW.Var_Source' and STG_T_PARENT_CHILD_D_2.Dim_name='#DW.Var_Dim_Name' AND TARG.GENERIC_ID=STG_T_PARENT_CHILD_D_2.GENERIC_ID)
where exists
(select distinct NULL from STG_#DW.Var_Dimension_Table_99 TARG, STG_T_PARENT_CHILD_D_2 where STG_T_PARENT_CHILD_D_2.MEMBER=TARG.#DW.Var_Dim_Child_Column_Num and STG_T_PARENT_CHILD_D_2.SOURCE='#DW.Var_Source' and STG_T_PARENT_CHILD_D_2.Dim_name='#DW.Var_Dim_Name' AND TARG.GENERIC_ID=STG_T_PARENT_CHILD_D_2.GENERIC_ID)</Field>
</Default>
</SessTaskLog>
</StepLog>
</SessStep>
<SessStep>
<Field name="Step Name">Go to next level</Field>
<Field name="Step No">14</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
<SessStep>
<Field name="Step Name">Var_Counter</Field>
<Field name="Step No">15</Field>
<Field name="Step Type">SET_VARIABLE</Field>
<Field name="Ok Exit">false</Field>
<Field name="Ko Exit">true</Field>
<StepLog/>
</SessStep>
</Session>
